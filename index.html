<html lang="en"><head>
<meta charset="UTF-8">
<link rel="apple-touch-icon" type="image/png" href="https://static.codepen.io/assets/favicon/apple-touch-icon-5ae1a0698dcc2402e9712f7d01ed509a57814f994c660df9f7a952f3060705ee.png">
<meta name="apple-mobile-web-app-title" content="Lai-shi-han">
<link rel="shortcut icon" type="image/x-icon" href="https://s2.aconvert.com/convert/p3r68-cdx67/ao026-96ru8-001.ico">
<link rel="mask-icon" type="" href="https://static.codepen.io/assets/favicon/logo-pin-8f3771b1072e3c38bd662872f6b673a722f4b3ca2421637d5596661b4e2132cc.svg" color="#111">
<title>i-bar</title>
<style>
html,body{
  width: 100%;
  height: 100%;
}

#map {
    width: 100%;
    height: 100%;
}



.marker-cluster-small {
		background-color: rgba(181, 226, 140, 0.6);
		}
	.marker-cluster-small div {
		background-color: rgba(110, 204, 57, 0.6);
		}

	.marker-cluster-medium {
		background-color: rgba(241, 211, 87, 0.6);
		}
	.marker-cluster-medium div {
		background-color: rgba(240, 194, 12, 0.6);
		}

	.marker-cluster-large {
		background-color: rgba(253, 156, 115, 0.6);
		}
	.marker-cluster-large div {
		background-color: rgba(241, 128, 23, 0.6);
		}

	.marker-cluster {
		background-clip: padding-box;
		border-radius: 20px;
		}
	.marker-cluster div {
		width: 30px;
		height: 30px;
		margin-left: 15px;
		margin-top: 5px;

		text-align: center;
		border-radius: 15px;
		font: 30px "Helvetica Neue", Arial, Source Sans Pro, sans-serif;
		}
	.marker-cluster span {
		line-height: 30px;
		}

@import url(https://fonts.googleapis.com/earlyaccess/cwtexyen.css);
.popup-name {
    padding-left: 10px;
    border-left: 5px solid rgb(16, 120, 121);
    color: #000000;
    font-family: 'cwTeXYen', sans-serif;
    line-height:2;
    font-size: 25px;
    font-weight: bold;
}

.popup-star {
  padding-left: 10px;
    border-left: 5px solid rgb(	255,215,0);
    color: #000000;
    font-family: 'cwTeXYen', sans-serif;
    line-height:2;
    font-size:20px;
    font-weight: bold;
}

.popup-address {
    padding-left: 10px;
    border-left: 5px solid rgb(220,20,60);
    color: #000000;
    font-family: 'cwTeXYen', sans-serif;
    line-height:2;
    font-size: larger;
    font-weight: bold;
}
</style>
</head>
<body translate="no">
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.6.0/dist/leaflet.css">
<link href="https://cdnjs.cloudflare.com/ajax/libs/leaflet.markercluster/1.4.1/MarkerCluster.css">
<link href="https://cdnjs.cloudflare.com/ajax/libs/leaflet.markercluster/1.4.1/MarkerCluster.Default.css">
<div id="map" class="leaflet-container leaflet-fade-anim leaflet-grab leaflet-touch-drag" tabindex="0" style="position: relative; outline: none;"><div class="leaflet-pane leaflet-map-pane" style="transform: translate3d(0px, 0px, 0px);"><div class="leaflet-pane leaflet-tile-pane"><div class="leaflet-layer " style="z-index: 1; opacity: 1;"><div class="leaflet-tile-container leaflet-zoom-animated" style="z-index: 19; transform: translate3d(0px, 0px, 0px) scale(1);"><img alt="" role="presentation" src="https://a.tile.openstreetmap.org/13/6852/3510.png" class="leaflet-tile leaflet-tile-loaded" style="width: 256px; height: 256px; transform: translate3d(-130px, 389px, 0px); opacity: 1;"><img alt="" role="presentation" src="https://b.tile.openstreetmap.org/13/6853/3510.png" class="leaflet-tile leaflet-tile-loaded" style="width: 256px; height: 256px; transform: translate3d(126px, 389px, 0px); opacity: 1;"><img alt="" role="presentation" src="https://c.tile.openstreetmap.org/13/6852/3509.png" class="leaflet-tile leaflet-tile-loaded" style="width: 256px; height: 256px; transform: translate3d(-130px, 133px, 0px); opacity: 1;"><img alt="" role="presentation" src="https://a.tile.openstreetmap.org/13/6853/3509.png" class="leaflet-tile leaflet-tile-loaded" style="width: 256px; height: 256px; transform: translate3d(126px, 133px, 0px); opacity: 1;"><img alt="" role="presentation" src="https://b.tile.openstreetmap.org/13/6852/3511.png" class="leaflet-tile leaflet-tile-loaded" style="width: 256px; height: 256px; transform: translate3d(-130px, 645px, 0px); opacity: 1;"><img alt="" role="presentation" src="https://c.tile.openstreetmap.org/13/6853/3511.png" class="leaflet-tile leaflet-tile-loaded" style="width: 256px; height: 256px; transform: translate3d(126px, 645px, 0px); opacity: 1;"><img alt="" role="presentation" src="https://b.tile.openstreetmap.org/13/6852/3508.png" class="leaflet-tile leaflet-tile-loaded" style="width: 256px; height: 256px; transform: translate3d(-130px, -123px, 0px); opacity: 1;"><img alt="" role="presentation" src="https://c.tile.openstreetmap.org/13/6853/3508.png" class="leaflet-tile leaflet-tile-loaded" style="width: 256px; height: 256px; transform: translate3d(126px, -123px, 0px); opacity: 1;"><img alt="" role="presentation" src="https://c.tile.openstreetmap.org/13/6852/3512.png" class="leaflet-tile leaflet-tile-loaded" style="width: 256px; height: 256px; transform: translate3d(-130px, 901px, 0px); opacity: 1;"><img alt="" role="presentation" src="https://a.tile.openstreetmap.org/13/6853/3512.png" class="leaflet-tile leaflet-tile-loaded" style="width: 256px; height: 256px; transform: translate3d(126px, 901px, 0px); opacity: 1;"></div></div></div><div class="leaflet-pane leaflet-shadow-pane"><img src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.7/images/marker-shadow.png" class="leaflet-marker-shadow leaflet-zoom-animated" alt="" style="margin-left: -43px; margin-top: -96px; width: 10px; height: 10px; transform: translate3d(420px, -140px, 0px);"><img src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.7/images/marker-shadow.png" class="leaflet-marker-shadow leaflet-zoom-animated" alt="" style="margin-left: -43px; margin-top: -96px; width: 10px; height: 10px; transform: translate3d(438px, 432px, 0px);"><img src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.7/images/marker-shadow.png" class="leaflet-marker-shadow leaflet-zoom-animated" alt="" style="margin-left: -43px; margin-top: -96px; width: 10px; height: 10px; transform: translate3d(335px, 144px, 0px);"></div><div class="leaflet-pane leaflet-overlay-pane"><svg pointer-events="none" class="leaflet-zoom-animated" width="337" height="1130" viewBox="-28 -94 337 1130" style="transform: translate3d(-28px, -94px, 0px);"><g><path class="leaflet-interactive" stroke="skyblue" stroke-opacity="1" stroke-width="3" stroke-linecap="round" stroke-linejoin="round" fill="#00298a" fill-opacity="0.1" fill-rule="evenodd" d="M0 0"></path><path class="leaflet-interactive" stroke="orange" stroke-opacity="1" stroke-width="3" stroke-linecap="round" stroke-linejoin="round" fill="#FF5809" fill-opacity="0.1" fill-rule="evenodd" d="M267.80870542209595,128.9506058250554a58,58 0 1,0 116,0 a58,58 0 1,0 -116,0 "></path></g></svg></div><div class="leaflet-pane leaflet-marker-pane"><div class="leaflet-marker-icon marker-cluster marker-cluster-small leaflet-zoom-animated leaflet-interactive" tabindex="0" style="margin-left: -20px; margin-top: -20px; width: 40px; height: 40px; transform: translate3d(301px, 418px, 0px); z-index: 418; opacity: 1;"><div><span>2</span></div></div><div class="leaflet-marker-icon marker-cluster marker-cluster-medium leaflet-zoom-animated leaflet-interactive" tabindex="0" style="margin-left: -20px; margin-top: -20px; width: 40px; height: 40px; transform: translate3d(499px, 178px, 0px); z-index: 178; opacity: 1;"><div><span>41</span></div></div><img src="https://github.com/Han-lai/i-bar_map/blob/master/icons8-cocktail1.png?raw=true" class="leaflet-marker-icon leaflet-zoom-animated leaflet-interactive" alt="" tabindex="0" style="margin-left: -43px; margin-top: -96px; width: 96px; height: 96px; transform: translate3d(420px, -140px, 0px); z-index: -140;"><img src="https://github.com/Han-lai/i-bar_map/blob/master/icons8-cocktail2.png?raw=true" class="leaflet-marker-icon leaflet-zoom-animated leaflet-interactive" alt="" tabindex="0" style="margin-left: -43px; margin-top: -96px; width: 96px; height: 96px; transform: translate3d(438px, 432px, 0px); z-index: 432;"><img src="https://github.com/Han-lai/i-bar_map/blob/master/icons8-cocktail1.png?raw=true" class="leaflet-marker-icon leaflet-zoom-animated leaflet-interactive" alt="" tabindex="0" style="margin-left: -43px; margin-top: -96px; width: 96px; height: 96px; transform: translate3d(335px, 144px, 0px); z-index: 144;"><div class="leaflet-marker-icon marker-cluster marker-cluster-small leaflet-zoom-animated leaflet-interactive" tabindex="0" style="margin-left: -20px; margin-top: -20px; width: 40px; height: 40px; transform: translate3d(564px, 323px, 0px); z-index: 323;"><div><span>4</span></div></div></div><div class="leaflet-pane leaflet-tooltip-pane"></div><div class="leaflet-pane leaflet-popup-pane"></div><div class="leaflet-proxy leaflet-zoom-animated" style="transform: translate3d(1.75438e+06px, 898642px, 0px) scale(4096);"></div></div><div class="leaflet-control-container"><div class="leaflet-top leaflet-left"><div class="leaflet-control-zoom leaflet-bar leaflet-control"><a class="leaflet-control-zoom-in" href="#" title="Zoom in" role="button" aria-label="Zoom in">+</a><a class="leaflet-control-zoom-out" href="#" title="Zoom out" role="button" aria-label="Zoom out">−</a></div></div><div class="leaflet-top leaflet-right"></div><div class="leaflet-bottom leaflet-left"></div><div class="leaflet-bottom leaflet-right"><div class="leaflet-control-attribution leaflet-control"><a href="https://leafletjs.com" title="A JS library for interactive maps">Leaflet</a> | © <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors</div></div></div></div>
<script src="https://unpkg.com/leaflet@1.6.0/dist/leaflet.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet.markercluster/1.4.1/leaflet.markercluster.js"></script>
<script id="rendered-js">
var map = L.map("map", {
  center: [24.954671, 121.221160],
  zoom: 16
});



var OpenStreetMap_Mapnik = L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
	maxZoom: 19,
	attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
}).addTo(map);



// ------------------------------------------------
// setView 可以設定地圖座標
// watch 則是持續監聽使用者的位置
map.locate({setView: true, watch: true});
// 成功監聽到使用者的位置時觸發
map.on('locationfound', onLocationFound);
// 失敗時觸發
map.on('locationerror', onLocationError);
function onLocationFound(e) {
}
function onLocationError(e) {
}

function onLocationFound(e) {
  var myLocation = e.latlng // 使用者位置
　var bookstore = L.latLng(24.964526, 121.193120) // 酒吧
  console.log(myLocation.distanceTo(bookstore)) // 計算使用者和酒吧的距離
}

-----------------------------------------



var circle = L.circle([25.040959, 121.553324],   // 圓心座標
                      100,                // 半徑（公尺）
                      {
  color: 'skyblue',      // 線條顏色
  fillColor: '#00298a', // 填充顏色
  fillOpacity: 0.1   // 透明度
}
                     ).addTo(map);

var circle = L.circle([24.966770, 121.191526],   // 圓心座標
 1000,                // 半徑（公尺）
  {
      color: 'orange',      // 線條顏色
      fillColor: '#FF5809', // 填充顏色
      fillOpacity: 0.1   // 透明度
  }
).addTo(map);

var Icon1 = new L.Icon({
  iconUrl: 'https://github.com/Han-lai/i-bar_map/blob/master/icons8-cocktail1.png?raw=true',
  shadowUrl: 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.7/images/marker-shadow.png',
    iconSize: [96, 96],
    iconAnchor: [43, 96],
    popupAnchor: [1, -96],
    shadowSize: [10, 10]
});

var Icon2 = new L.Icon({
  iconUrl: 'https://github.com/Han-lai/i-bar_map/blob/master/icons8-cocktail2.png?raw=true',
  shadowUrl: 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.7/images/marker-shadow.png',
    iconSize: [96, 96],
    iconAnchor: [43, 96],
    popupAnchor: [1, -96],
    shadowSize: [10, 10]
});

var Icon3 = new L.Icon({
    iconUrl: 'https://github.com/Han-lai/i-bar_map/blob/master/icons8-cocktail3.png?raw=true',
    shadowUrl: 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.7/images/marker-shadow.png',
    iconSize: [96, 96],
    iconAnchor: [43, 96],
    popupAnchor: [1, -96],
    shadowSize: [10, 10]
});

var blackIcon = new L.Icon({
    iconUrl: 'https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-black.png',
    shadowUrl: 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.7/images/marker-shadow.png',
    iconSize: [96, 96],
    iconAnchor: [43, 96],
    popupAnchor: [1, -96],
    shadowSize: [10, 10]
});

var markers = new L.MarkerClusterGroup().addTo(map);;
//在中心座標，放上黑色定位圖標
//L.marker([25.037801, 121.548855], { icon: blackIcon }).addTo(map);


var xhr = new XMLHttpRequest();
xhr.open('get', 'https://raw.githubusercontent.com/Han-lai/i-bar_map/master/bar_location/taipei_taotuan.json');
xhr.send();
xhr.onload = function () {
    var data = JSON.parse(xhr.responseText).results;
    for (var i = 0; i < data.length; i++) {

        //將酒吧星級標記不同顏色的圖標
        var imageIcon = blackIcon;
        if (data[i].rating >= 4.5)
            imageIcon = Icon1;
        else if (data[i].rating > 4.0)
            imageIcon = Icon2;
        else if (data[i].rating > 3.0)
            imageIcon = Icon3;
        
        //設定藥局經緯度和 Popup 內容
        var mark = L.marker([
            data[i].geometry.location.lat,
            data[i].geometry.location.lng
        ], { icon: imageIcon }
        ).bindPopup(
            '<p class="popup-name"> ' + 
                data[i].name + '<p/>' +
            '<p class="popup-star">   評分數 : ' + 
                data[i].rating + '<p/>' +
            '<p class="popup-address">地址 : ' + 
                data[i].vicinity + '<p/>', { minWidth:600 ,maxHeight: 500});
        //將圖標加入圖層
        markers.addLayer(mark);
    }
    map.addLayer(markers);
};
    </script>


</body></html>
